# =====================
# Docker Compose cho SWP
# =====================
version: '3.8'

services:
	backend:
		build:
			context: ./BackEnd
			dockerfile: Dockerfile
		container_name: swp-backend
		restart: unless-stopped
		ports:
			- "3000:3000"
		environment:
			- NODE_ENV=production
			- DB_HOST=postgres
			- DB_PORT=5432
			- DB_USERNAME=postgres
			- DB_PASSWORD=123456
			- DB_DATABASE=fuel_management
		depends_on:
			- postgres
		networks:
			- swp-network

	frontend:
		build:
			context: ./FrontEnd
			dockerfile: Dockerfile
		container_name: swp-frontend
		restart: unless-stopped
		ports:
			- "80:80"
		depends_on:
			- backend
		networks:
			- swp-network

	postgres:
		image: postgres:15-alpine
		container_name: swp-postgres
		restart: unless-stopped
		environment:
			- POSTGRES_USER=postgres
			- POSTGRES_PASSWORD=123456
			- POSTGRES_DB=fuel_management
		ports:
			- "5432:5432"
		volumes:
			- pgdata:/var/lib/postgresql/data
			- ./BackEnd/docker-initdb/01-schema.sql:/docker-entrypoint-initdb.d/01-schema.sql:ro
			- ./BackEnd/docker-initdb/02-data.sql:/docker-entrypoint-initdb.d/02-data.sql:ro
		networks:
			- swp-network

networks:
	swp-network:
		driver: bridge

volumes:
	pgdata:
